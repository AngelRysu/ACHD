{% extends 'layout.html' %}

{% block title %}Asignacion{% endblock %}

{% block body_class %}asignacion{% endblock %}

{% block css %}
<style>
  .btns {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0.5rem;
  }


  .btns .semestre {
    width: 100px;
    height: 30px;
    margin-left: 10px;
    margin-right: 10px;
    border-radius: 15px;
    transition: .5s;
  }

  .btns .semestre:hover {
    background-color: blue;
    color: white;
  }

  .btnsturn {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .btnsturn .turno:hover {
    background-color: blue;
    color: white;
  }

  .btnsturn .turno {
    width: 100px;
    height: 30px;
    margin-left: 10px;
    margin-right: 10px;
    border-radius: 15px;
    transition: .5s;
  }

  .btnsturn .turno.selected {
    background-color: blue;
    color: white;
  }


  .container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 0.5fr;
    gap: 0px 0px;
    grid-auto-flow: row;
    grid-template-areas:
      "docentes horario"
      "materias aulas";
  }

  .docentes {
    grid-area: docentes;
    height: 22rem;
    display: flex;
    text-align: center;
    flex-wrap: wrap;
  }

  .horario {
    grid-area: horario;
    height: 22rem;
    text-align: center;
  }

  .materias {
    grid-area: materias;
    background-color: lightyellow;
    height: 22rem;
    display: flex;
    text-align: center;
    flex-wrap: wrap;
  }

  .aulas {
    grid-area: aulas;
    background-color: lightcoral;
    height: 22rem;
    display: flex;
    text-align: center;
    flex-wrap: wrap;
  }

  .btn {
    display: flex;
    align-items: center;
    justify-content: end;
  }

  .savebtn {
    width: 100px;
    height: 30px;
    margin-left: 10px;
    margin-right: 10px;
    border-radius: 15px;
    transition: .5s;
  }

  .semestre.selected {
    background-color: blue;
    color: white;
  }

  .docente {
    height: 55px;
    background-color: green;
    border-radius: 5px;
    margin: 5px;
  }

  .docente p {
    user-select: none;
    text-align: center;
    margin-top: 5px;
  }

  .materia {
    width: auto;
    height: 55px;
    background-color: #897baf;
    color: white;
    border-radius: 5px;
    margin: 5px;
  }

  .materia p {
    user-select: none;
    text-align: center;
    margin-top: 5px;
  }

  .aula {
    width: auto;
    height: 55px;
    background-color: #897baf;
    border-radius: 5px;
    margin: 5px;
  }

  .aula p {
    user-select: none;
    text-align: center;
    margin-top: 5px;
  }

  table {
    user-select: none;
    background-color: black;
    width: 50rem;
    max-width: auto;
    height: 20rem;
  }

  table tr {
    background-color: white;
  }
  table td{
    border: 1px solid;
  }

  .semestre.selected {
    background-color: blue;
    color: white;
  }

  .selected {
    background-color: lightblue;
    /* Cambiar el color de fondo de los elementos seleccionados */
  }
</style>
{% endblock %}

{% block content %}
<div class="btns">
  <button class="semestre" data-semestre="1">Semestre 1</button>
  <button class="semestre" data-semestre="2">Semestre 2</button>
  <button class="semestre" data-semestre="3">Semestre 3</button>
  <button class="semestre" data-semestre="4">Semestre 4</button>
  <button class="semestre" data-semestre="5">Semestre 5</button>
  <button class="semestre" data-semestre="6">Semestre 6</button>
  <button class="semestre" data-semestre="7">Semestre 7</button>
  <button class="semestre" data-semestre="8">Semestre 8</button>
  <button class="semestre" data-semestre="9">Semestre 9</button>
</div>
<div class="btnsturn">
  <p>Turno :</p>
  <button class="turno" id="turnA">A</button>
  <button class="turno" id="turnB">B</button>
  <button class="turno" id="turnN">N</button>
</div>

<div class="container">
  <div class="docentes">
    <p>docentes</p>

    {% for docente in docentes %}
    <div class="docente" data-disponibilidad='{{docente.disponibilidad}}' 
    data-id-docente='{{docente.id}}'>
      <p><strong>{{docente.nombre}} {{docente.apellido_pat}} </strong></p>
    </div>
    {% endfor %}
  </div>

  <div class="horario">
    <table id="TablaHorario">
      <tr>
        <th>horas</th>
        <th>lunes</th>
        <th>martes</th>
        <th>miercoles</th>
        <th>jueves</th>
        <th>viernes</th>
        <th>sabado</th>
      </tr>
      <tr>
        <td class="hora hora-1">7-8</td>
        <td class="dia" id="0"></td>
        <td class="dia" id="15"></td>
        <td class="dia" id="30"></td>
        <td class="dia" id="45"></td>
        <td class="dia" id="60"></td>
        <td class="dia" id="75"></td>
      </tr>
      <tr>
        <td class="hora hora-2">8-9</td>
        <td class="dia" id="1"></td>
        <td class="dia" id="16"></td>
        <td class="dia" id="31"></td>
        <td class="dia" id="46"></td>
        <td class="dia" id="61"></td>
        <td class="dia" id="76"></td>
      </tr>
      <tr>
        <td class="hora hora-3">9-10</td>
        <td class="dia" id="2"></td>
        <td class="dia" id="17"></td>
        <td class="dia" id="32"></td>
        <td class="dia" id="47"></td>
        <td class="dia" id="62"></td>
        <td class="dia" id="77"></td>
      </tr>
      <tr>
        <td class="hora hora-4">10-11</td>
        <td class="dia" id="3"></td>
        <td class="dia" id="18"></td>
        <td class="dia" id="33"></td>
        <td class="dia" id="48"></td>
        <td class="dia" id="63"></td>
        <td class="dia" id="78"></td>
      </tr>
      <tr>
        <td class="hora hora-5">11-12</td>
        <td class="dia" id="4"></td>
        <td class="dia" id="19"></td>
        <td class="dia" id="34"></td>
        <td class="dia" id="49"></td>
        <td class="dia" id="64"></td>
        <td class="dia" id="79"></td>
      </tr>
      <tr>
        <td class="hora hora-6">12-13</td>
        <td class="dia" id="5"></td>
        <td class="dia" id="20"></td>
        <td class="dia" id="35"></td>
        <td class="dia" id="50"></td>
        <td class="dia" id="65"></td>
        <td class="dia" id="80"></td>
      </tr>
      <tr>
        <td class="hora hora-7">13-14</td>
        <td class="dia" id="6"></td>
        <td class="dia" id="21"></td>
        <td class="dia" id="36"></td>
        <td class="dia" id="51"></td>
        <td class="dia" id="66"></td>
        <td class="dia" id="81"></td>
      </tr>
      <tr>
        <td class="hora hora-8">14-15</td>
        <td class="dia" id="7"></td>
        <td class="dia" id="22"></td>
        <td class="dia" id="37"></td>
        <td class="dia" id="52"></td>
        <td class="dia" id="67"></td>
        <td class="dia" id="82"></td>
      </tr>
    </table>
  </div>
  <div class="materias">
    <p>materias</p>
    {% for asignatura in asignaturas %}
    <div class="materia" data-semestre="{{ asignatura.semestre }}" 
    data-id-materia='{{asignatura.id}}'>
      <p>{{ asignatura.nombre }}</p>
      <p>Créditos: {{ asignatura.creditos }}</p>
    </div>
    {% endfor %}
  </div>
  <div class="aulas">
    <p>aulas</p>
    {% for aula in aulas %}
    <div class="aula" data-id-aula="{{aula.id}}">
      <p>{{ aula.nombre }}</p>
      <p>{{ aula.edificio }}</p>
    </div>
    {% endfor %}
  </div>
</div>
<div class="btn">
  <button class="savebtn"> guardar</button>
</div>

<script>
  let diasOriginales = obtenerDiasOriginales();
  let disponibilidad;
  // Controlador de eventos para los botones de turno
  const horasOriginales = obtenerHorasOriginales();
  const turnA = document.getElementById("turnA");
  const turnB = document.getElementById("turnB");
  const turnN = document.getElementById("turnN");

  turnA.classList.add('selected');

  turnA.addEventListener("click", function () {
    restaurarHorasOriginales();
    cambiarTurno("A");
  });

  turnB.addEventListener("click", function () {
    restaurarHorasOriginales();
    cambiarTurno("B");
  });

  turnN.addEventListener("click", function () {
    cambiarTurno("N");
  });

  function handleClickDocente() {
    // Obtener la disponibilidad del docente desde el atributo data-disponibilidad
    disponibilidad = JSON.parse(this.getAttribute('data-disponibilidad'));
    // Llamar a la función para actualizar los colores de la tabla
    actualizarColoresTablaPorDisponibilidad(disponibilidad);
}
  function cambiarTurno(turno) {
    document.querySelectorAll(".turno").forEach(btn => btn.classList.remove('selected'));
    document.getElementById(`turn${turno}`).classList.add('selected');
    const dias = document.querySelectorAll(".dia");
    if (turno === "N") {
        dias.forEach(function (dia, index) {
            const id = parseInt(diasOriginales[index]) + 7;
            dia.id = id.toString(); // Actualizar el ID del día
        });
        const horas = document.querySelectorAll(".hora");
        horas.forEach(function (hora, index) {
            let inicio = 14 + index;
            let fin = 15 + index;
            if (fin > 22) {
                fin = 22;
            }
            hora.textContent = inicio.toString().padStart(2, '0') + '-' + fin.toString().padStart(2, '0');
        });
    } else {
        // Restaurar los IDs originales
        dias.forEach(function (dia, index) {
            dia.id = diasOriginales[index]; // Restaurar el ID del día
        });
    }
    
    // Actualizar los colores de la tabla según la disponibilidad de los docentes después de cambiar el turno
    actualizarColoresTablaPorDisponibilidad(disponibilidad);
}
  function actualizarColoresTablaPorDisponibilidad(disponibilidad) {
  // Obtener todos los elementos .dia de la tabla
  const dias = document.querySelectorAll(".dia");
  // Iterar sobre los elementos .dia y actualizar el color según la disponibilidad del docente
  dias.forEach(dia => {
    // Obtener el índice del día desde el ID del elemento .dia
    const index = parseInt(dia.id);
    // Verificar si la disponibilidad del docente en el día correspondiente es 1
    if (disponibilidad.disponibilidad[index] === 1) {
      dia.style.backgroundColor = "#2EDC41";
    } else {
      dia.style.backgroundColor = "#FF6E33"; 
    }
  });
}

document.querySelectorAll(".docente").forEach(docente => {
  docente.addEventListener("click", handleClickDocente);
});

  function obtenerDiasOriginales() {
    const diasOriginales = [];
    const dias = document.querySelectorAll(".dia");
    dias.forEach(function (dia) {
      diasOriginales.push(dia.id);
    });
    return diasOriginales;
  }

  function obtenerHorasOriginales() {
    const horasOriginales = [];
    const horas = document.querySelectorAll(".hora");
    horas.forEach(function (hora) {
      horasOriginales.push(hora.textContent);
    });
    return horasOriginales;
  }

  function restaurarHorasOriginales() {
    const horas = document.querySelectorAll(".hora");
    horas.forEach(function (hora, index) {
      hora.textContent = horasOriginales[index];
    });
  }

  // Controlador de eventos para seleccionar docentes, materias y aulas
  let selectedElements = [];

  document.querySelectorAll(".docente, .materia, .aula").forEach(item => {
    item.addEventListener("click", function () {
        const elementType = this.classList.contains('docente') ? 'docente' : this.classList.contains('materia') ? 'materia' : 'aula';
        const elementText = this.textContent.trim();
        const elementId = this.getAttribute(`data-id-${elementType}`); // Obtener el data-id correspondiente

        // Deseleccionar cualquier otro elemento del mismo tipo
        selectedElements = selectedElements.filter(element => element.type !== elementType);
        document.querySelectorAll(`.${elementType}.selected`).forEach(element => {
            element.classList.remove('selected');
        });

        // Agregar el nuevo elemento seleccionado
        let trimmedText = elementType === 'materia' ? elementText.replace(/Créditos.*/g, '').trim() : elementText.trim();
        
        // Verificar el tipo de elemento y su posición en el arreglo selectedElements
        if (elementType === 'docente') {
            selectedElements.unshift({ type: elementType, text: trimmedText, id: elementId }); // Agregar al principio del arreglo
        } else if (elementType === 'materia') {
            selectedElements.splice(1, 0, { type: elementType, text: trimmedText, id: elementId }); // Agregar en la segunda posición del arreglo
        } else {
            selectedElements.push({ type: elementType, text: trimmedText, id: elementId }); // Agregar al final del arreglo
        }
        
        this.classList.add('selected');
        
        // Verificar si hay un conjunto completo de elementos seleccionados
        if (selectedElements.length === 3) {
            // Obtener los IDs en el mismo orden que los elementos seleccionados
            const ids = selectedElements.map(element => element.id);
        }
    });
});

  // Controlador de eventos para las celdas vacías de la tabla
  document.querySelectorAll(".horario td:not(.hora)").forEach(cell => {
    cell.addEventListener("click", function () {
        const hasOneOfEachType = selectedElements.filter(element => element.type === 'docente').length > 0 &&
            selectedElements.filter(element => element.type === 'materia').length > 0 &&
            selectedElements.filter(element => element.type === 'aula').length > 0;

        if (hasOneOfEachType) {
            cell.textContent = "";

            cell.style.backgroundColor = "white";
            // Crear elementos de div para cada uno de los elementos seleccionados y agregarlos a la celda
            selectedElements.forEach(element => {
                const newContent = document.createElement("div");
                newContent.textContent = element.text;
                newContent.setAttribute('data-id', element.id); // Guardar el valor data-id del elemento seleccionado
                cell.appendChild(newContent);
            });

            // Obtener los IDs de los elementos seleccionados y mostrarlos en la consola
            const ids = selectedElements.map(element => element.id);
        }
    });
});


  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.semestre').forEach(function (button) {
      button.addEventListener('click', function () {
        // Elimina la clase 'selected' de todos los botones de semestre
        document.querySelectorAll('.semestre').forEach(function (btn) {
          btn.classList.remove('selected');
        });

        // Agrega la clase 'selected' al botón de semestre seleccionado
        this.classList.add('selected');

        var semestre = this.getAttribute('data-semestre');

        // Oculta todas las asignaturas
        document.querySelectorAll('.materia').forEach(function (asignatura) {
          asignatura.style.display = 'none';
        });

        // Muestra las asignaturas del semestre seleccionado
        document.querySelectorAll('.materia[data-semestre="' + semestre + '"]').forEach(function (asignatura) {
          asignatura.style.display = 'block';
        });
      });
    });
  });
  // Simula un clic en el botón del semestre 1 al cargar la página
  document.addEventListener('DOMContentLoaded', function () {
    // Obtiene el botón del semestre 1
    const semestre1Btn = document.querySelector('.semestre[data-semestre="1"]');

    // Si el botón del semestre 1 existe, simula un clic en él
    if (semestre1Btn) {
      semestre1Btn.click();
    }
  });
  document.querySelectorAll(".turno").forEach(btn => {
    btn.addEventListener("click", function () {
      document.querySelectorAll(".dia").forEach(cell => {
        cell.textContent = "";
      });
    });
  });
  document.querySelectorAll('.semestre').forEach(function (button) {
    button.addEventListener('click', function () {
      document.querySelectorAll(".dia").forEach(cell => {
        cell.textContent = "";
      });
    });
  });

</script>

{% endblock %}